<!doctype html>
<html lang="id">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Selamat Menonton Sayangü•∞</title>

<style>
body{
  margin:0;
  min-height:100vh;
  display:flex;
  align-items:center;
  justify-content:center;
  background:#000;
  font-family:Arial,sans-serif;
}
.container{
  position:relative;
  width:100%;
  max-width:720px;
}
video{
  width:100%;
  border-radius:10px;
}
#overlay{
  position:absolute;
  inset:0;
  background:rgba(0,0,0,.85);
  color:#fff;
  display:flex;
  align-items:center;
  justify-content:center;
  text-align:center;
  border-radius:10px;
  padding:20px;
}
button{
  padding:14px 22px;
  font-size:16px;
  border:none;
  border-radius:8px;
  background:#ff5722;
  color:#fff;
  cursor:pointer;
}
button:active{ transform:scale(.97); }
.countdown {
  margin-top: 10px;
  font-size: 14px;
  color: #ffcc00;
}
</style>
</head>

<body>

<div class="container">
  <video id="vid" controls playsinline preload="metadata">
    <source src="https://cdn.videy.co/pnFlSdvt1.mp4" type="video/mp4">
  </video>

  <div id="overlay">
    <div id="content">
      <h3>üîû WAJIB KLIK UNTUK MELANJUTKAN</h3>
      <button id="startBtn">LANJUTKAN ‚ñ∂</button>
      <div id="countdown" class="countdown"></div>
    </div>
  </div>
</div>

<script>
const video = document.getElementById("vid");
const overlay = document.getElementById("overlay");
const content = document.getElementById("content");
const startBtn = document.getElementById("startBtn");
const countdownEl = document.getElementById("countdown");

const shopeeLink = "https://s.shopee.co.id/5L4wuJqb2U";

const monetagLinks = [
  "https://otieu.com/4/9703244",
  "https://otieu.com/4/9815426",
  "https://otieu.com/4/9815424",
  "https://otieu.com/4/10071971",
  "https://otieu.com/4/9703236",
  "https://otieu.com/4/9815427",
  "https://otieu.com/4/9815425",
  "https://otieu.com/4/9815422",
  "https://otieu.com/4/9815420",
  "https://otieu.com/4/9815428"
];

let step = -1;
let countdownInterval = null;

// Fungsi untuk mendapatkan IP pengguna
async function getUserIP() {
  try {
    const response = await fetch('https://api.ipify.org?format=json');
    const data = await response.json();
    return data.ip;
  } catch (error) {
    // Fallback menggunakan Math.random jika API gagal
    console.error('Gagal mendapatkan IP:', error);
    return 'unknown_' + Math.random().toString(36).substr(2, 9);
  }
}

// Cek apakah user sudah menyelesaikan klik sebelumnya (dengan batas 1 jam)
async function checkUserStatus() {
  const userData = JSON.parse(localStorage.getItem('videoAccess_1hour') || '{}');
  const currentIP = await getUserIP();
  const now = Date.now();
  const oneHour = 60 * 60 * 1000; // 1 jam dalam milidetik
  
  // Cek apakah data masih valid (IP sama dan belum lewat 1 jam)
  if (userData.ip === currentIP && 
      userData.completed === true && 
      (now - userData.timestamp) < oneHour) {
    
    // Tampilkan informasi sisa waktu
    startCountdownTimer(userData.timestamp + oneHour);
    
    overlay.style.display = 'none';
    video.play();
    return true;
  }
  
  // Jika data tidak valid atau sudah kedaluwarsa
  if ((now - (userData.timestamp || 0)) >= oneHour) {
    console.log('Akses telah kedaluwarsa (1 jam)');
    localStorage.removeItem('videoAccess_1hour');
  }
  
  return false;
}

// Fungsi untuk menampilkan countdown timer
function startCountdownTimer(expiryTime) {
  clearInterval(countdownInterval);
  
  countdownInterval = setInterval(() => {
    const now = Date.now();
    const timeLeft = expiryTime - now;
    
    if (timeLeft <= 0) {
      clearInterval(countdownInterval);
      countdownEl.textContent = '‚è∞ Waktu akses telah habis!';
      
      // Reset akses setelah 5 detik
      setTimeout(() => {
        localStorage.removeItem('videoAccess_1hour');
        overlay.style.display = 'flex';
        video.pause();
        countdownEl.textContent = '';
      }, 5000);
      return;
    }
    
    const minutes = Math.floor(timeLeft / (60 * 1000));
    const seconds = Math.floor((timeLeft % (60 * 1000)) / 1000);
    
    countdownEl.textContent = `‚è∞ Akses berlaku: ${minutes}:${seconds.toString().padStart(2, '0')}`;
  }, 1000);
}

// Fungsi untuk format waktu countdown
function updateCountdownDisplay(endTime) {
  const now = Date.now();
  const timeLeft = endTime - now;
  
  if (timeLeft <= 0) return "00:00";
  
  const minutes = Math.floor(timeLeft / (60 * 1000));
  const seconds = Math.floor((timeLeft % (60 * 1000)) / 1000);
  
  return `${minutes}:${seconds.toString().padStart(2, '0')}`;
}

// Blok play sebelum selesai
video.addEventListener("play", (e) => {
  e.preventDefault();
  video.pause();
  overlay.style.display = "flex";
});

// Inisialisasi - cek status user
checkUserStatus().then(hasAccess => {
  if (!hasAccess) {
    overlay.style.display = 'flex';
    
    // Cek dan tampilkan waktu tunggu jika ada
    const userData = JSON.parse(localStorage.getItem('videoAccess_1hour') || '{}');
    const now = Date.now();
    const oneHour = 60 * 60 * 1000;
    
    if (userData.timestamp && (now - userData.timestamp) < oneHour) {
      const timeLeft = oneHour - (now - userData.timestamp);
      const minutesLeft = Math.ceil(timeLeft / (60 * 1000));
      
      content.innerHTML = `
        <h3>üîû TUNGGU ${minutesLeft} MENIT LAGI</h3>
        <p style="font-size:14px; color:#ffcc00;">Anda bisa menonton lagi dalam ${minutesLeft} menit</p>
        <div id="countdown" class="countdown"></div>
      `;
      
      // Update countdown
      const expiryTime = userData.timestamp + oneHour;
      countdownInterval = setInterval(() => {
        const display = updateCountdownDisplay(expiryTime);
        document.getElementById('countdown').textContent = `‚è∞ Tunggu: ${display}`;
        
        if (Date.now() >= expiryTime) {
          clearInterval(countdownInterval);
          location.reload();
        }
      }, 1000);
    }
  }
});

// Klik pertama ‚Üí Shopee
startBtn.onclick = () => {
  window.open(shopeeLink, "_blank");
  step = 0;
  showNext();
};

function showNext(){
  if(step < monetagLinks.length){
    content.innerHTML = `
      <h3>LANJUTKAN (${step+1}/${monetagLinks.length})</h3>
      <button id="nextBtn">BUKA LINK ‚ñ∂</button>
      <div id="countdown" class="countdown"></div>
    `;
    document.getElementById("nextBtn").onclick = async () => {
      window.open(monetagLinks[step], "_blank");
      step++;
      
      // Jika sudah selesai semua link
      if(step >= monetagLinks.length){
        // Dapatkan IP user
        const userIP = await getUserIP();
        
        // Simpan status bahwa user sudah complete dengan timestamp
        const userData = {
          ip: userIP,
          completed: true,
          timestamp: Date.now(),
          expires: Date.now() + (60 * 60 * 1000) // 1 jam dari sekarang
        };
        
        localStorage.setItem('videoAccess_1hour', JSON.stringify(userData));
        
        // Simpan juga di cookie untuk backup (2 jam)
        const expiry = new Date();
        expiry.setTime(expiry.getTime() + (2 * 60 * 60 * 1000));
        document.cookie = `videoAccess_1hour=${encodeURIComponent(JSON.stringify(userData))}; expires=${expiry.toUTCString()}; path=/`;
        
        // Mulai countdown timer
        startCountdownTimer(userData.expires);
        
        // Sembunyikan overlay dan play video
        overlay.style.display = "none";
        video.play();
        
        // Set timeout untuk reset setelah 1 jam
        setTimeout(() => {
          console.log('Akses telah kadaluarsa (1 jam)');
          localStorage.removeItem('videoAccess_1hour');
          
          // Jika video masih diputar, pause dan tampilkan overlay
          if (!video.paused) {
            video.pause();
            overlay.style.display = 'flex';
            content.innerHTML = `
              <h3>üîû WAKTU TELAH HABIS</h3>
              <p style="font-size:14px; color:#ffcc00;">Akses 1 jam telah berakhir</p>
              <button onclick="location.reload()">MULAI LAGI</button>
            `;
          }
        }, 60 * 60 * 1000);
        
      } else {
        showNext();
      }
    };
  }
}

// Fungsi untuk membersihkan data kedaluwarsa secara berkala
function cleanupExpiredData() {
  const userData = JSON.parse(localStorage.getItem('videoAccess_1hour') || '{}');
  const now = Date.now();
  const oneHour = 60 * 60 * 1000;
  
  if (userData.timestamp && (now - userData.timestamp) >= oneHour) {
    localStorage.removeItem('videoAccess_1hour');
    console.log('Membersihkan data akses yang kedaluwarsa (1 jam)');
  }
}

// Jalankan cleanup saat halaman dimuat
cleanupExpiredData();

// Timer untuk menunjukkan sisa waktu akses
async function showAccessTime() {
  const userData = JSON.parse(localStorage.getItem('videoAccess_1hour') || '{}');
  if (userData.timestamp && userData.ip) {
    const currentIP = await getUserIP();
    const now = Date.now();
    const oneHour = 60 * 60 * 1000;
    
    if (userData.ip === currentIP && (now - userData.timestamp) < oneHour) {
      const timeLeft = oneHour - (now - userData.timestamp);
      const minutes = Math.floor(timeLeft / (60 * 1000));
      const seconds = Math.floor((timeLeft % (60 * 1000)) / 1000);
      
      console.log(`‚è∞ Sisa waktu akses: ${minutes} menit ${seconds} detik`);
    }
  }
}

// Auto refresh countdown setiap menit
setInterval(() => {
  const userData = JSON.parse(localStorage.getItem('videoAccess_1hour') || '{}');
  if (userData.timestamp) {
    const now = Date.now();
    const oneHour = 60 * 60 * 1000;
    
    if ((now - userData.timestamp) >= oneHour) {
      console.log('Waktu akses telah habis, reloading...');
      localStorage.removeItem('videoAccess_1hour');
      
      if (!overlay.style.display || overlay.style.display === 'none') {
        location.reload();
      }
    }
  }
}, 60000); // Cek setiap 1 menit

// Jalankan pengecekan waktu akses
showAccessTime();

// Cleanup saat tab ditutup
window.addEventListener('beforeunload', () => {
  clearInterval(countdownInterval);
});
</script>

</body>
</html>